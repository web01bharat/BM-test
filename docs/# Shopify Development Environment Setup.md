# Shopify Development Environment Setup

## Prerequisites
- Node.js (v16+)
- npm or yarn
- Git

## Installing Shopify CLI
```bash
npm install -g @shopify/cli @shopify/theme
```

## Authentication
Log in to your Shopify store:
```bash
shopify auth login
```

## Basic Commands
- Initialize a new theme: `shopify theme init [name]`
- Pull an existing theme: `shopify theme pull --store=your-store.myshopify.com --theme=your-theme-id`
- Start development server: `shopify theme dev --store=your-store.myshopify.com`
- Push theme changes: `shopify theme push --store=your-store.myshopify.com`
- List themes: `shopify theme list --store=your-store.myshopify.com`

## SCSS Workflow

Our template uses a proper SCSS workflow that accommodates Shopify's file structure requirements:

1. **Source files**: Located in the `scss/` directory at the repository root
   - These files are not uploaded to Shopify
   - Organized with proper partials and imports

2. **Compiled output**: The compiled CSS is saved to `assets/theme.css`
   - This file is uploaded to Shopify
   - Do not edit this file directly (edit SCSS source files instead)

3. **Development workflow**:
   - Edit SCSS files in the `scss/` directory
   - Run `npm run watch` to automatically compile changes
   - Run `npm run dev` in a separate terminal to preview changes

## JavaScript Development

Shopify themes can leverage JavaScript to enhance the shopping experience. Our template provides a structured approach to JavaScript development.

### JavaScript File Organization

1. **Main JavaScript file**: `assets/custom-global.js`
   - Automatically included in theme.liquid
   - Loaded with `defer` attribute for better performance
   - Used for theme-wide functionality

2. **Additional JavaScript files**:
   - Can be created directly in the `assets` directory
   - Must be included manually in theme.liquid or section files
   - No subdirectories allowed (Shopify limitation)

3. **Section-specific JavaScript**:
   - Can be included inline in section files using `{% javascript %}` tags
   - Automatically isolated to prevent conflicts

### Accessing Shopify Data

Shopify exposes various JavaScript objects and APIs you can leverage:

```javascript
// Access the current cart
fetch('/cart.js')
  .then(response => response.json())
  .then(cart => {
    console.log('Cart items:', cart.items);
    console.log('Cart total:', cart.total_price/100);
  });

// Access product information (on product pages)
if (window.Shopify && window.Shopify.Product) {
  console.log('Current product:', window.Shopify.Product);
}

// Access shop information
console.log('Shop currency:', window.Shopify.currency.active);
console.log('Shop money format:', window.Shopify.money_format);
```

### Working with Shopify's Theme Editor

When adding JavaScript functionality, consider how it interacts with Shopify's Theme Editor:

1. **Section settings**: Listen for the `shopify:section:load` event to reinitialize scripts when sections are reloaded

```javascript
document.addEventListener('shopify:section:load', function(event) {
  // The section ID that was loaded
  const sectionId = event.detail.sectionId;
  
  // Re-initialize components in this section
  initializeSection(sectionId);
});
```

2. **Block settings**: Handle dynamic content changes with the `shopify:block:select` event

```javascript
document.addEventListener('shopify:block:select', function(event) {
  // The block that was selected
  const blockId = event.detail.blockId;
  
  // Perform any necessary actions when block is selected in editor
});
```

### JavaScript Best Practices

1. **Performance optimization**:
   - Use `defer` attribute for script loading (already done in theme.liquid)
   - Minimize DOM manipulations
   - Debounce event handlers for performance-intensive operations

2. **Code organization**:
   - Use the module pattern or ES6 modules (with transpilation)
   - Keep code focused and component-based
   - Document complex functionality

3. **Compatibility**:
   - Test across multiple browsers and devices
   - Consider progressive enhancement for critical features
   - Use feature detection instead of browser detection

### Debugging JavaScript

1. **Browser developer tools**:
   - Use Chrome/Firefox DevTools to debug JavaScript
   - Set breakpoints to step through code execution
   - Monitor network requests when fetching data

2. **Common issues**:
   - Script loading order problems
   - DOM not ready when scripts run
   - Conflicts with other theme JavaScript
   - Cross-origin issues with external resources

3. **Theme Editor specific**:
   - Preview mode behaves differently than published themes
   - Section/block events only fire in the Theme Editor

### Example: Custom JavaScript Structure

A well-organized `custom-global.js` file might look like:

```javascript
// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', () => {
  // Initialize global components
  initHeader();
  initMobileMenu();
  initProductForms();
  
  // Listen for Shopify section events
  setupSectionListeners();
});

// Header functionality
function initHeader() {
  const header = document.querySelector('.site-header');
  // Header initialization code...
}

// Mobile menu toggle
function initMobileMenu() {
  const toggleButton = document.querySelector('.mobile-menu-toggle');
  // Mobile menu initialization code...
}

// Product forms (add to cart functionality)
function initProductForms() {
  const forms = document.querySelectorAll('form[action="/cart/add"]');
  
  forms.forEach(form => {
    form.addEventListener('submit', function(event) {
      event.preventDefault();
      
      // Get form data
      const formData = new FormData(form);
      
      // Submit form via fetch API
      fetch('/cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(item => {
        // Update mini-cart
        updateMiniCart();
      })
      .catch(error => {
        console.error('Error adding item to cart:', error);
      });
    });
  });
}

// Set up section reload listeners for Theme Editor
function setupSectionListeners() {
  document.addEventListener('shopify:section:load', event => {
    const sectionId = event.detail.sectionId;
    const sectionEl = document.getElementById(`shopify-section-${sectionId}`);
    
    // Re-initialize components based on section type
    if (sectionEl.classList.contains('header-section')) {
      initHeader();
    } else if (sectionEl.classList.contains('product-section')) {
      initProductForms();
    }
  });
}
```

## GitHub Integration

Shopify's GitHub integration requires theme files to be at the repository root. Our template follows this requirement:

- Theme files (`assets/`, `sections/`, etc.) are at the repository root
- SCSS source files are in the `scss/` directory (not uploaded to Shopify)
- No theme files are stored in subdirectories (which would cause errors)

For more details, see our [GitHub Integration Guide](github-integration.md).

## Common Issues

### "Branch isn't a valid theme" Error
This error occurs when theme files are not at the repository root. Ensure that your theme files (assets, config, layout, etc.) are directly in the repository root, not in a subdirectory.

### "Theme files may not be stored in subfolders" Error
Shopify doesn't allow theme assets to be stored in subdirectories. Our template addresses this by:
- Keeping all SCSS source files in the `scss/` directory (not uploaded to Shopify)
- Compiling to a single CSS file (`assets/theme.css`) at the root level of the assets directory
